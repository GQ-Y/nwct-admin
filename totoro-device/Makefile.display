# NWCT Display System Makefile

.PHONY: all build-preview build-prod test-display clean

# å¼€å‘ç¯å¢ƒæ„å»ºï¼ˆMac M1 SDL2 é¢„è§ˆï¼‰
build-preview:
	@echo "ğŸ”¨ æ„å»ºå¼€å‘é¢„è§ˆç‰ˆæœ¬ï¼ˆSDL2ï¼‰..."
	go build -tags preview -o bin/nwct-preview ./cmd/display-test/
	@echo "âœ… æ„å»ºå®Œæˆ: bin/nwct-preview"

# ç”Ÿäº§ç¯å¢ƒæ„å»ºï¼ˆFramebufferï¼‰
build-prod:
	@echo "ğŸ”¨ æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ˆFramebufferï¼‰..."
	go build -o bin/nwct-client ./main.go
	@echo "âœ… æ„å»ºå®Œæˆ: bin/nwct-client"

# äº¤å‰ç¼–è¯‘åˆ° ARM64 Linuxï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
build-linux-arm64:
	@echo "ğŸ”¨ äº¤å‰ç¼–è¯‘åˆ° Linux ARM64..."
	GOOS=linux GOARCH=arm64 go build -o bin/nwct-client-linux-arm64 ./main.go
	@echo "âœ… æ„å»ºå®Œæˆ: bin/nwct-client-linux-arm64"

# è¿è¡Œå¼€å‘é¢„è§ˆ
run-preview: build-preview
	@echo "ğŸš€ å¯åŠ¨æ˜¾ç¤ºé¢„è§ˆ..."
	./bin/nwct-preview

# æµ‹è¯•æ˜¾ç¤ºç³»ç»Ÿ
test-display:
	@echo "ğŸ§ª æµ‹è¯•æ˜¾ç¤ºç³»ç»Ÿ..."
	go test -v ./internal/display/...

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf bin/
	@echo "âœ… æ¸…ç†å®Œæˆ"

# å®‰è£…ä¾èµ–
deps:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	brew list sdl2 >/dev/null 2>&1 || brew install sdl2
	go get github.com/veandco/go-sdl2/sdl
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

# é»˜è®¤ç›®æ ‡
all: build-preview

# å¸®åŠ©ä¿¡æ¯
help:
	@echo "NWCT Display System - æ„å»ºå‘½ä»¤:"
	@echo "  make build-preview       - æ„å»ºå¼€å‘é¢„è§ˆç‰ˆæœ¬ï¼ˆSDL2ï¼‰"
	@echo "  make build-prod          - æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ˆFramebufferï¼‰"
	@echo "  make build-linux-arm64   - äº¤å‰ç¼–è¯‘åˆ° Linux ARM64"
	@echo "  make run-preview         - è¿è¡Œå¼€å‘é¢„è§ˆ"
	@echo "  make test-display        - æµ‹è¯•æ˜¾ç¤ºç³»ç»Ÿ"
	@echo "  make clean               - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  make deps                - å®‰è£…ä¾èµ–"

