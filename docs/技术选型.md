# 技术选型文档

## 1. 后端技术选型

### 1.1 编程语言
**选择: Go语言**

**理由**:
- 编译型语言，性能优秀
- 并发模型（Goroutine）适合网络编程
- 跨平台编译，支持ARM架构（单片机）
- 标准库丰富，网络编程支持完善
- 内存占用小，适合资源受限环境
- 部署简单，单文件可执行程序

### 1.2 Web框架
**选择: Gin**

**理由**:
- 轻量级，性能优秀
- 路由功能完善
- 中间件支持丰富
- 文档完善，社区活跃
- 适合RESTful API开发

**替代方案**: Echo、Fiber

### 1.3 NPS客户端
**选择: github.com/ehang-io/nps**

**理由**:
- 官方Go语言实现
- 功能完整，支持多种穿透模式
- 配置简单
- 稳定可靠

### 1.4 MQTT客户端
**选择: github.com/eclipse/paho.mqtt.golang**

**理由**:
- Eclipse官方实现
- 功能完整，支持MQTT 3.1.1和5.0
- 支持TLS加密
- 支持QoS级别
- 支持Last Will和Retain消息
- 社区活跃，维护良好

**替代方案**: 
- gomqtt（轻量级）
- mqtt（功能较少）

### 1.5 网络扫描库
**选择: github.com/google/gopacket**

**理由**:
- Google维护，质量可靠
- 支持多种网络协议解析
- 支持原始套接字操作
- 功能强大，适合网络扫描和探针

**补充库**:
- `golang.org/x/net`: 网络工具库
- `github.com/shirou/gopsutil`: 系统信息获取

### 1.6 数据库
**选择: SQLite**

**理由**:
- 轻量级，无需独立服务器
- 文件数据库，部署简单
- 支持SQL查询
- 性能满足需求
- Go驱动成熟（github.com/mattn/go-sqlite3）

**替代方案**: 
- BadgerDB（键值数据库）
- BoltDB（键值数据库）

### 1.7 配置管理
**选择: JSON配置文件 + Viper（可选）**

**理由**:
- JSON格式易读易写
- 无需额外依赖
- 支持嵌套结构
- Viper可用于复杂配置管理（可选）

### 1.8 日志库
**选择: logrus 或 zap**

**理由**:
- logrus: 功能丰富，API友好
- zap: 性能优秀，适合高频日志
- 支持日志级别、格式化、输出到文件

**推荐**: 根据性能需求选择，资源受限环境可选标准库log

### 1.9 认证授权
**选择: JWT (github.com/golang-jwt/jwt)**

**理由**:
- 无状态认证
- 适合RESTful API
- 实现简单
- 性能优秀

### 1.10 WebSocket
**选择: github.com/gorilla/websocket**

**理由**:
- 功能完整
- 性能优秀
- 文档完善
- 社区活跃

## 2. 前端技术选型

### 2.1 框架
**选择: React + TypeScript**

**理由**:
- 组件化开发，代码复用性好
- 生态丰富，组件库多
- TypeScript提供类型安全
- 社区活跃，资源丰富

### 2.2 UI组件库
**选择: Ant Design**

**理由**:
- 组件丰富，开箱即用
- 设计美观，符合现代UI趋势
- 文档完善，示例丰富
- 支持主题定制
- 适合管理后台开发

**替代方案**:
- Material-UI
- Chakra UI

### 2.3 状态管理
**选择: React Hooks + Context API**

**理由**:
- 轻量级，无需额外库
- 适合中小型应用
- 学习成本低

**替代方案**（如果状态复杂）:
- Redux Toolkit
- Zustand

### 2.4 HTTP客户端
**选择: Axios**

**理由**:
- 功能完善
- 支持拦截器
- 自动JSON转换
- 错误处理友好

### 2.5 WebSocket客户端
**选择: 原生WebSocket API 或 socket.io-client**

**理由**:
- 原生API简单直接
- socket.io提供自动重连等功能

### 2.6 构建工具
**选择: Vite**

**理由**:
- 构建速度快
- 开发体验好
- 配置简单
- 支持React和TypeScript

**替代方案**: Create React App

### 2.7 路由
**选择: React Router**

**理由**:
- 官方推荐
- 功能完善
- 文档齐全

### 2.8 图表库
**选择: ECharts for React 或 Recharts**

**理由**:
- 功能强大，图表类型丰富
- 适合数据可视化
- 文档完善

## 3. 开发工具

### 3.1 版本控制
**Git**

### 3.2 代码格式化
- Go: gofmt, golangci-lint
- TypeScript/React: Prettier, ESLint

### 3.3 测试框架
- Go: 标准库testing + testify
- React: Jest + React Testing Library

### 3.4 文档工具
- API文档: Swagger/OpenAPI
- 代码文档: GoDoc, JSDoc

## 4. 部署相关

### 4.1 编译
- Go: 交叉编译支持ARM架构
- React: 构建为静态文件

### 4.2 打包
- 后端: 单文件可执行程序
- 前端: 静态文件打包

### 4.3 配置管理
- 环境变量
- 配置文件
- 命令行参数

## 5. 依赖管理

### 5.1 Go依赖
- **工具**: go mod
- **版本**: Go 1.21+

### 5.2 前端依赖
- **工具**: npm 或 yarn
- **包管理**: package.json

## 6. 性能考虑

### 6.1 后端优化
- 使用连接池
- 并发控制
- 内存优化
- 日志异步写入

### 6.2 前端优化
- 代码分割
- 懒加载
- 虚拟滚动（长列表）
- 防抖节流

## 7. 安全性考虑

### 7.1 后端安全
- 密码加密（bcrypt）
- JWT Token过期机制
- 请求频率限制
- 输入验证和清理

### 7.2 前端安全
- XSS防护
- CSRF防护
- 敏感信息不存储在客户端
- HTTPS支持

## 8. 兼容性

### 8.1 浏览器支持
- Chrome/Edge (最新版本)
- Firefox (最新版本)
- Safari (最新版本)

### 8.2 设备支持
- ARM架构单片机
- Linux系统
- 网络接口: 有线网口、WiFi

## 9. 开发环境要求

### 9.1 后端开发
- Go 1.21+
- Git

### 9.2 前端开发
- Node.js 18+
- npm 或 yarn

## 10. 第三方服务

### 10.1 MQTT服务器
- **自建**: Mosquitto, EMQ X
- **云服务**: 
  - HiveMQ Cloud
  - AWS IoT Core
  - 阿里云IoT平台
  - 腾讯云IoT平台

### 10.2 NPS服务端
- **自建**: 部署在公网服务器
- **云服务**: 云服务器部署

## 11. 监控和调试

### 11.1 日志
- 结构化日志
- 日志级别控制
- 日志轮转

### 11.2 调试
- Go: Delve调试器
- React: React DevTools
- 网络: Wireshark, tcpdump

### 11.3 监控
- 系统资源监控
- 服务状态监控
- 网络连接监控

